<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="viewport" content="width=1024 height=768 initial-scale=1, user-scalable=no">
		<title>LES MILLS - Global</title>
		<link rel="stylesheet" href="../css/default.css" type="text/css" >
		<style type="text/css" >
			.container { width:93%; margin:80px auto 0; }
			
			.highcharts-yaxis-labels span { left: 53px !important; width: 40px; text-align: center; }
			.grid-blue { position:absolute; width: 80%; top:441px; left:161px; height:60px; z-index:0; }
			.grid-blue li { float:left; width:1px; height:inherit; margin-right:55px; position:relative; }
			.grid-blue li, .grid-blue li:after { background:rgba(0, 137, 150, 0.4); }
			.grid-blue li:after { content:''; width:5px; height:5px; position:absolute; left:-2px; bottom:-5px; -webkit-border-radius:100px; border-radius:100px; }
			.grid-blue li:nth-child(2n+1) { height:2px; }
			.grid-blue li:nth-child(2), 
				.grid-blue li:nth-child(6),
				.grid-blue li:nth-child(9),
				.grid-blue li:nth-child(13)  { margin-right:56px; }
			.grid-blue li:last-child { margin-right:0; }
			.slide-footer .reset { background-position-y:-586px; }
			.slide-footer .play { background-position-y: -148px; right: 100px;  }
			#cls.close { display:block; }
			
		</style>
	</head>
	<body>
		<section id="contentWrapper">
		<header><span class="salutation"></span> <h2>LES MILLS CYCLING VALUE PROPOSITION</h2> <div class="logo"></div> </header>
        	<div class="inner-wrapper black-mid-bg">
            <span class="top-gradient"></span>
            <span class="bottom-gradient"></span>
            <span id="cls" class="close x i"></span>
            
                <div class="container"> </div>
                <!-- footer navigation -->
                <div class="slide-footer">
                    <ul>
                        <li class="go-to-home"></li>
                        <li class="reset abs"></li>
                        <!-- <li class="play btn-inact abs" data-video="bundle"></li>
                      		
                         <li class="go-to-chart hide"></li>-->
                    </ul>
            	</div>
                    
        	</div>
		</section>
        <script src="../lib/jquery-1.11.0.min.js" type="text/javascript" ></script> 
        <script src="../lib/highcharts.js" type="text/javascript" ></script>
        <script src="../lib/draggable-points.js" type="text/javascript" ></script>
        
        <script src="../lib/touchy.js" type="text/javascript" ></script> 
		<script src="../lib/globals.js" type="text/javascript" ></script>
		
		<script type="text/javascript">
			$( function(){
				
				var labels = ["", "<strong style='display:block; text-align:center; font-size:20px;'>L</strong>Low", "<strong style='display:block; text-align:center; font-size:20px;'>M</strong>Medium", "<strong style='display:block; text-align:center; font-size:20px;'>H</strong>High", ""],
					points = [3.515, 1.1, 1.2, 2.15, 0.99, 1.18, 1.8, 1.3, 1.7, 0.99, 0.99, 1.4, 1.9, 1.5, 3.3],
					draggableData = points;
				//auth user	
				if(!$.isEmptyObject(_prevUserData) && !$.isEmptyObject(cEmail)){
					for(d in _prevUserData){
						var prevUser = (d).split('$'), rep = {'_':'.', 'Z101Z':'_', 'X101X':'-'}, pt1 = '', pt2 = '';
							
						if(prevUser[1] && prevUser[2]){
							pt1 = prevUser[1].replace(/_|Z101Z|X101X/g, function(match){ return rep[match]; });
							pt2 = prevUser[2].replace(/_/g, function(match){ return rep[match]; });
						}
						if(pt1+'@'+pt2 === cEmail){
							var storedPoints = _prevUserData[d][0].propositionData;
							//console.log(storedPoints)
							if(!$.isEmptyObject(storedPoints)){
								
								draggableData = [];
								$.each(storedPoints, function(k, v){
									draggableData.push(v);
								})
							}
						}
					}
				}
				
				$('.container').highcharts({ 
					title: {
						text: ''
					},
					navigation: {
						buttonOptions: {
							enabled: false
						}
					},
					credits: {
						enabled:false 
					},
					legend: {
						enabled:false 
					},
					chart: {
						events: {
							redraw: function(){
								//console.log('redrew!!!')
								resizePath('c');
							}
						},
						backgroundColor: 'none',
						height:510,
						type: 'line',
						animation: false,
						style: {
							fontFamily: 'TradeGothicCon18'
						},
						plotBorderColor: '#ffffff'						
					},	
					tooltip: {
						enabled: false
					},			
					xAxis: {
						categories: ['Range of activities & services', 'Specialization', 'Brand, story & marketing', 'Digital marketing & community', 'Inspiring studio design', 'Experiential technology', 'Motivating instructors', 'Instructor pay', 'Consistency of instructor quality', 'Scientific programming', 'End-to-end user experience', 'Enabling technology', 'Exercise & fitness prescription', 'Convenient classes', 'Price'],
						labels: {
							style: {
								color: '#ffffff',
								fontSize: 12,
								textAlign: 'center'
							},
							staggerLines: 2,
							y : 30
						},
						tickmarkPlacement: 'on',
						gridLineWidth: 1,
						tickLength: 18,
						tickWidth: 1,
						tickColor: 'rgba(0, 137, 150, 0.4)',
						gridLineColor: 'rgba(0, 137, 150, 0.4)',
						lineColor: '#ffffff',
						
					},
					 plotOptions: {
						series: {
					 		lineWidth: 3,
							dashStyle: 'dot',
							marker: {
								radius: 5
							},
							point: {
								events: {
									drop: function(){
										//console.log(this.index);
									}
								}
							}
							
						}
					 },
					yAxis: {
						 title: {
                			text: 'FOCUS',
							style: { 
								color: '#ffffff', 
								fontSize: 22 
							}
            			},
						max: 4,
						tickInterval: 1,
						labels: {
							formatter: function() {
								return labels[this.value]
							},
							style: {
								color: "#ffffff",
								fontSize: 14,
								textAlign: 'center'
							}/*,
							useHTML: true*/
						},
						gridLineWidth: 2,
            			gridLineColor:  '#6a6a6a'
						
					}, 
					series:[{
						
						lineColor: '#d2bd56',
						marker: {
							symbol: 'url(img/point-g.png)',
							fillColor:'#d2bd56'
						},
						name: 'Benchmark',
						data: [1, 3.5, 3.3, 3.4, 3.5, 1.2, 1.9, 3.2, 1.8, 1.1, 3.2, 3.3, 1, 3.1, 1]
					},
					{
						lineColor: '#ffffff',
						marker: {
							symbol: 'url(img/point-w.png)',
							fillColor:'#ffffff'
						},
						name: 'Your club',
						draggableY: true,
						dragMinY: 1,
						dragMaxY: 3.5,
						minPointLength: 1,
						data: draggableData,
						zIndex: 10 
					}]
				
				})
			function resizePath(e){
				$(".highcharts-axis > path:nth-child(2n+2)").each(function() {
					var t = $(this),
						d1 = t.attr('d').split('L')[0],
						d2 = t.attr('d').split('L')[1].split(' ')[0];
                   // t.attr('d', t.attr('d').replace('405', 445));
				   //console.log(t.attr('d').split('L')[1]+' > '+d1+' : '+d2)
					
                });
				$('.highcharts-yaxis-labels text').each( function(){
					var $this = $(this),
						tspan = $this.find('tspan:first-child'),
						tspan2 = $this.find('tspan:last-child');
						
						if(e === 'b'){ $this.attr('x', '125'); }else{ $this.attr('x', '110'); }
						tspan.css('font-size','22').attr({dx:0, dy:0 });
						tspan2.attr({ dx:'-15', dy:20 });
						
						
						//console.log(tspan2.text())
						if(tspan2.text() === "Medium"){
							tspan2.attr('dx','-25');
						}
				})
			}
				
				var closeBtn = $('#cls'),
					chart = $('.container').highcharts(),
					backToSlide = $.parseJSON(localStorage.getItem(storagePre+'toPropositionSlide'));
					
					closeBtn.on('tap', function(){
						resizePath('b')
						var propositionData = [],
							oSerializer = new XMLSerializer(),
							sXML = oSerializer.serializeToString(document.querySelector(".highcharts-container svg")),
							canvas = document.createElement('canvas');
							
						for(var i=0; i < chart.series[1].data.length; i++){
							propositionData.push(chart.series[1].data[i].y);
						}
						localStorage.setItem(storagePre+'propositionData', JSON.stringify(propositionData));
						
						//save chart results as image
						canvg(canvas, sXML, { 
							ignoreMouse: true, 
							ignoreAnimation: true,  
							renderCallback: function(){
								url = canvas.toDataURL("image/png");
								localStorage.setItem(storagePre+'resultProposition', canvas.toDataURL("image/png"));
								storeUserData('');
							}
						});
						
						if(!$.isEmptyObject(backToSlide) && backToSlide != 'None'){
							window.location.href = 'asset://name/'+backToSlide;
							//goToSlide('cls', backToSlide);
						}
						
					})
				//reset
				$('.reset').on('tap', function(){
					//console.log('clicked!')
					chart.series[1].setData(points, true);
				})
					
				
				//$('#contentWrapper').append("<img src='"+localStorage.getItem(storagePre+'resultProposition')+"'/>")
				//console.log($.parseJSON(localStorage.getItem(storagePre+'propositionData')));
				//console.log(localStorage.getItem(storagePre+'resultProposition'));
				//localStorage.setItem(storagePre+'whichProgramme', JSON.stringify(progName));
				//window.location.href = 'asset://name/0.1.7.1-lm-programming-solution-tables';
			})
		</script>
    
	</body>
</html>